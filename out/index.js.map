{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["// Undo/Redo \u7121\u52B9\u5316\r\ndocument.body.addEventListener('keydown', (event) => {\r\n\tif (event.ctrlKey) {\r\n\t\tswitch (event.key) {\r\n\t\tcase 'z':\r\n\t\tcase 'y':\r\n\t\t\tevent.preventDefault()\r\n\t\t\treturn\r\n\t\t}\r\n\t}\r\n})\r\nconst textarea = document.getElementById('textarea') as HTMLTextAreaElement\r\nlet lastValue = ''\r\ntextarea.addEventListener('input', (event: InputEvent) => {\r\n\tswitch (event.inputType) {\r\n\tcase 'historyUndo':\r\n\tcase 'historyRedo':\r\n\t\ttextarea.value = lastValue\r\n\t\treturn\r\n\tdefault:\r\n\t\tlastValue = textarea.value\r\n\t\treturn\r\n\t}\r\n})\r\n// \u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\u30AD\u30FC\r\ntextarea.addEventListener('keydown', (event) => {\r\n\tif (!event.ctrlKey) {\r\n\t\treturn\r\n\t}\r\n\tswitch (event.key) {\r\n\tcase 'z':\r\n\t\tif (!event.shiftKey) {\r\n\t\t\tundoAction()\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse {\r\n\t\t\tredoAction()\r\n\t\t\treturn\r\n\t\t}\r\n\tcase 'y':\r\n\t\tredoAction()\r\n\t\treturn\r\n\t}\r\n})\r\n// \u5165\u529B\u5185\u5BB9\r\nclass InputData {\r\n\tconstructor (\r\n\t\tpublic value         : string,                      // \u5165\u529B\u3055\u308C\u305F\u5024\r\n\t\tpublic start         : number,                      // \u5165\u529B\u3055\u308C\u305F\u5024\u306E\u958B\u59CB\u5730\u70B9\r\n\t\tpublic end           : number,                      // \u5165\u529B\u3055\u308C\u305F\u5024\u306E\u7D42\u4E86\u5730\u70B9\r\n\t\tpublic before        : string,                      // \u5165\u529B\u3055\u308C\u308B\u524D\u306E\u5024\r\n\t\tpublic fromSelection : 'select' | 'start' | 'end',  // \u5165\u529B\u6642\u306E SelectionMode\r\n\t\tpublic doMore        : boolean,                     // \u6B21\u306E Undo \u3092\u7D9A\u3051\u3066\u5B9F\u884C\u3059\u308B\u304B\r\n\t\tpublic undo?         : InputData                    // Redo \u306E\u57FA\u3068\u306A\u3063\u305F Undo\r\n\t) {}\r\n}\r\n// Undo/Redo\r\nconst undoStack: InputData[] = []\r\nconst redoStack: InputData[] = []\r\n// Undo\r\nconst undoAction = (redoDoMore = false) => {\r\n\tif (undoStack.length === 0) {\r\n\t\treturn\r\n\t}\r\n\tconst data = undoStack.pop()\r\n\ttextarea.setRangeText(data.before, data.start, data.end, data.fromSelection)\r\n\tredoStack.push(new InputData(\r\n\t\tdata.before,\r\n\t\tdata.start,\r\n\t\tdata.start + data.before.length,\r\n\t\tdata.value,\r\n\t\tdata.fromSelection,\r\n\t\tredoDoMore,\r\n\t\tdata\r\n\t))\r\n\tupdateLog()\r\n\tif (data.doMore) {\r\n\t\tundoAction(true)\r\n\t}\r\n}\r\n// Redo\r\nconst redoAction = () => {\r\n\tif (redoStack.length === 0) {\r\n\t\treturn\r\n\t}\r\n\tconst data = redoStack.pop()\r\n\ttextarea.setRangeText(data.before, data.start, data.end, data.fromSelection)\r\n\tundoStack.push(data.undo)\r\n\tupdateLog()\r\n\tif (data.doMore) {\r\n\t\tredoAction()\r\n\t}\r\n}\r\n// \u76F4\u524D\u306E\u9078\u629E\u5185\u5BB9\r\nlet selectionText: string\r\ndocument.addEventListener('selectionchange', () => {\r\n\tselectionText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\r\n})\r\n// IME\r\nlet imeBefore    : string\r\nlet imeTextStart : number\r\nlet imeTextEnd   : number\r\ntextarea.addEventListener('compositionstart', () => {\r\n\timeBefore = selectionText\r\n})\r\ntextarea.addEventListener('compositionupdate', () => {\r\n\timeTextStart = textarea.selectionStart\r\n\timeTextEnd = textarea.selectionEnd\r\n})\r\ntextarea.addEventListener('compositionend', () => {\r\n\t// \u5165\u529B\u3092\u5168\u3066\u524A\u9664\u3057\u305F\u5834\u5408\r\n\tif (imeTextStart === textarea.selectionEnd) {\r\n\t\treturn\r\n\t}\r\n\tundoStack.push(new InputData(\r\n\t\ttextarea.value.slice(imeTextStart, imeTextEnd),\r\n\t\timeTextStart,\r\n\t\timeTextEnd,\r\n\t\timeBefore,\r\n\t\t'end',\r\n\t\tfalse\r\n\t))\r\n\tredoStack.length = 0\r\n\tupdateLog()\r\n})\r\n// \u8FFD\u52A0\r\ntextarea.addEventListener('input', (event: InputEvent) => {\r\n\tswitch (event.inputType) {\r\n\t// IME \u5909\u63DB\u4E2D\uFF06\u78BA\u5B9A\u6642\r\n\tcase 'insertCompositionText':\r\n\t\t// InputEvent \u3067\u306F\u6271\u308F\u306A\u3044\r\n\t\treturn\r\n\t// \u6539\u884C (event.data === null)\r\n\tcase 'insertLineBreak':\r\n\t\tundoStack.push(new InputData(\r\n\t\t\t'\\n',\r\n\t\t\ttextarea.selectionEnd - 1,\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\tselectionText,\r\n\t\t\t'end',\r\n\t\t\tfalse\r\n\t\t))\r\n\t\tredoStack.length = 0\r\n\t\tupdateLog()\r\n\t\treturn\r\n\t}\r\n\t// \u30C9\u30ED\u30C3\u30D7\r\n\tif (event.inputType === 'insertFromDrop') {\r\n\t\tundoStack.push(new InputData(\r\n\t\t\ttextarea.value.slice(textarea.selectionStart, textarea.selectionEnd),\r\n\t\t\ttextarea.selectionStart,\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\t'',\r\n\t\t\t'select',  // redo \u6642\u306E\u30C9\u30E9\u30C3\u30B0\u7528\r\n\t\t\ttrue\r\n\t\t))\r\n\t\tredoStack.length = 0\r\n\t\tupdateLog()\r\n\t\treturn\r\n\t}\r\n\t// \u30AD\u30FC\u30DC\u30FC\u30C9\u5165\u529B\r\n\tif (event.data !== null) {\r\n\t\tundoStack.push(new InputData(\r\n\t\t\tevent.data,\r\n\t\t\ttextarea.selectionEnd - event.data.length,\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\tselectionText,\r\n\t\t\t'end',\r\n\t\t\tfalse\r\n\t\t))\r\n\t\tredoStack.length = 0\r\n\t\tupdateLog()\r\n\t\treturn\r\n\t}\r\n})\r\n// \u8CBC\u308A\u4ED8\u3051\r\ntextarea.addEventListener('paste', (event) => {\r\n\tconst value = event.clipboardData.getData('text')\r\n\tundoStack.push(new InputData(\r\n\t\tvalue,\r\n\t\ttextarea.selectionEnd,\r\n\t\ttextarea.selectionEnd + value.length,\r\n\t\tselectionText,\r\n\t\t'end',\r\n\t\tfalse\r\n\t))\r\n\tredoStack.length = 0\r\n\tupdateLog()\r\n})\r\n// \u524A\u9664\r\n// BackSpace/Delete\r\ntextarea.addEventListener('beforeinput', (event: InputEvent) => {\r\n\tif (textarea.selectionStart === textarea.selectionEnd) {\r\n\t\tswitch (event.inputType) {\r\n\t\tcase 'deleteContentBackward':\r\n\t\t\tselectionText = textarea.value.slice(textarea.selectionStart - 1, textarea.selectionEnd)\r\n\t\t\treturn\r\n\t\tcase 'deleteContentForward':\r\n\t\t\tselectionText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd + 1)\r\n\t\t\treturn\r\n\t\t}\r\n\t}\r\n})\r\ntextarea.addEventListener('input', (event: InputEvent) => {\r\n\tswitch (event.inputType) {\r\n\tcase 'deleteContentBackward':\r\n\t\tundoStack.push(new InputData(\r\n\t\t\t'',\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\tselectionText,\r\n\t\t\t'end',\r\n\t\t\tfalse\r\n\t\t))\r\n\t\tredoStack.length = 0\r\n\t\tupdateLog()\r\n\t\treturn\r\n\tcase 'deleteContentForward':\r\n\t\tundoStack.push(new InputData(\r\n\t\t\t'',\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\tselectionText,\r\n\t\t\t'start',\r\n\t\t\tfalse\r\n\t\t))\r\n\t\tredoStack.length = 0\r\n\t\tupdateLog()\r\n\t\treturn\r\n\tcase 'deleteByDrag':\r\n\t\tundoStack.push(new InputData(\r\n\t\t\t'',\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\ttextarea.selectionEnd,\r\n\t\t\tselectionText,\r\n\t\t\t'select',\r\n\t\t\tfalse\r\n\t\t))\r\n\t\tredoStack.length = 0\r\n\t\tupdateLog()\r\n\t\treturn\r\n\t}\r\n})\r\n// \u5207\u308A\u53D6\u308A\r\ntextarea.addEventListener('cut', () => {\r\n\tundoStack.push(new InputData(\r\n\t\t'',\r\n\t\ttextarea.selectionStart,\r\n\t\ttextarea.selectionStart,  // selectionEnd: \u5207\u308A\u53D6\u308A\u524D\u306E\u4F4D\u7F6E\u306A\u306E\u3067\u99C4\u76EE\r\n\t\tselectionText,\r\n\t\t'select',\r\n\t\tfalse\r\n\t))\r\n\tredoStack.length = 0\r\n\tupdateLog()\r\n})\r\n// \u30ED\u30B0\r\nconst undoLog = document.getElementById('undo')\r\nconst redoLog = document.getElementById('redo')\r\nconst updateLog = () => {\r\n\tundoLog.textContent = ''\r\n\tredoLog.textContent = ''\r\n\tconst undoTemp = document.createDocumentFragment()\r\n\tfor (const data of undoStack) {\r\n\t\tconst line = document.createElement('div')\r\n\t\tline.style.borderBottom = '1px solid #000'\r\n\t\tline.textContent = `(${data.start}-${data.end}) value: ${data.value}, before: ${data.before}`\r\n\t\tundoTemp.appendChild(line)\r\n\t}\r\n\tconst redoTemp = document.createDocumentFragment()\r\n\tfor (const data of redoStack) {\r\n\t\tconst line = document.createElement('div')\r\n\t\tline.style.borderBottom = '1px solid #000'\r\n\t\tline.textContent = `(${data.start}-${data.end}) value: ${data.value}, before: ${data.before}`\r\n\t\tredoTemp.appendChild(line)\r\n\t}\r\n\tundoLog.appendChild(undoTemp)\r\n\tredoLog.appendChild(redoTemp)\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
